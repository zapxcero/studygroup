<footer class="card-footer">
  <%res = RestClient.get("#{supabase_url}/rest/v1/attendances?attended_event_id=eq.#{event["id"]}&select=attendee_id", common_headers )%>

    <%gz = Zlib::GzipReader.new(StringIO.new(res.body))%>
    <%attendees = JSON.parse(gz.read)%>

      
  <% attendees = attendees.map { |hash| hash["attendee_id"] } %>
  <%if attendees.include?(current_user) %>
      <%= button_to "Cancel", attendance_path(event["id"]) , method: :delete, class: "button is-medium is-danger is-outlined my-3", name: "attended_event_id",value: event["id"] %>
  <% elsif event["creator_id"] != current_user%>
    <%= form_with url: attendances_path, method: :post do |f|%>
      <%= f.hidden_field :attended_event_id, value: event['id'] %>
      <%= f.submit "Attend", class: "button is-medium is-info is-outlined my-3" %>
    <% end %>
  <% end %>
  <% if event["creator_id"] == current_user%>
    <%= link_to "Edit", edit_event_path(event["id"]), class: "card-footer-item"%>
    <%= button_to "Delete", event_path(event["id"]), method: :delete, class: "button is-medium is-danger my-3"%>
  <% end %>
</footer>
